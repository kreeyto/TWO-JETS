# MULTIC-TS-LBM

**MULTIC-TS-LBM** is a **thread-safe**, GPU-accelerated simulator for multicomponent jet flows using the Lattice Boltzmann Method (LBM). Designed with CUDA for high performance, it supports **D3Q19** and **D3Q27** velocity sets for hydrodynamics, and **D3Q7** for phase-field evolution. The solver simulates multiphase flows with sharp interface dynamics, surface tension effects, and configurable perturbations.

Post-processed results are exported as `.vtr` files for visualization in **ParaView**.

---

## üñ•Ô∏è System Requirements

### Hardware
- NVIDIA GPU with compute capability **‚â• 6.0** (Pascal, Volta, Turing, Ampere, Hopper)
- Minimum **2 GB** of GPU memory (4 GB or more recommended for larger simulations)

### Software
- **CUDA Toolkit** ‚â• 11.0
- **C++ compiler** (e.g., `g++`, `nvcc`)
- **Python 3.x** with:
  - `numpy`
  - `pyevtk`
- **ParaView** for visualizing `.vtr` outputs

---

## üóÇÔ∏è Project Structure

| Path              | Description |
|-------------------|-------------|
| `src/`            | C/C++ and CUDA source files |
| `post/`           | Python scripts for converting simulation output to VTK |
| `compile.sh`      | Script to compile the simulator binary |
| `pipeline.sh`     | Unified execution script: compile ‚Üí simulate ‚Üí post-process |
| `bin/`            | Stores compiled binaries and results |

---

## üöÄ Running a Simulation

### 1. Run the Full Pipeline

```bash
./pipeline.sh <velocity_set> <id>
```

* `velocity_set`: either `D3Q19` or `D3Q27`
* `id`: simulation identifier (e.g., `000`)

Example:

```bash
./pipeline.sh D3Q27 000
```

This performs:

1. Compilation (`nvcc`)
2. Execution (GPU simulation)
3. Post-processing (`.vtr` generation)

---

## üìÅ Output Structure

Results are saved to:

```
bin/<velocity_set>/<id>/
```

Key files:

* Binary `.bin` outputs per field (e.g., `phi`, `uz`)
* `*_info.txt`: metadata
* `.vtr` files generated by `exampleVTK.py`

---

## üìä Post-Processing

The post-processing workflow is shared with https://github.com/CERNN/MR-LBM. It uses Python scripts to parse binary outputs and convert them to `.vtr` files compatible with **ParaView**.

---

## üß† File Responsibilities

### üîß `src/` - CUDA & Simulation Logic

#### üìÇ `.cu` Files ‚Äì Core Implementation

| File              | Description                                            |
| ----------------- | ------------------------------------------------------ |
| `main.cu`         | Entry point: orchestrates full simulation              |
| `device_setup.cu` | Memory allocation and GPU-side constant setup          |
| `lbm.cu`          | Main LBM algorithm (collision, streaming, evolution)   |
| `lbm_int.cu`      | Phase field and surface tension interface calculations |
| `lbm_bcs.cu`      | Boundary conditions (inflow, periodic, outflow)        |

#### üìÇ `.cuh` Files ‚Äì Headers & Declarations

| File                   | Description                                        |
| ---------------------- | -------------------------------------------------- |
| `device_header.cuh`    | Device variables and fields declaration            |
| `constants.cuh`        | Physical/mesh parameters, D3Q set definitions      |
| `kernels.cuh`          | Kernel declarations                                |
| `host_functions.cuh`   | Data saving and simulation metadata creation       |
| `device_functions.cuh` | GPU helpers (indexing, equilibrium calculations)   |
| `error_def.cuh`        | CUDA error handling wrappers                       |
| `common.cuh`           | Common includes                                    |

### üìä `post/` - Python Post-Processing

| File               | Description                                          |
| ------------------ | ---------------------------------------------------- |
| `get_sim_info.py`  | File discovery, binary reading, metadata parsing     |
| `grid_to_vtk.py`   | VTK conversion using `pyevtk`                        |
| `process_steps.py` | Batch post-processing to generate `.vtr` files       |
| `run_post.sh`      | Cross-platform VTK runner (calls `process_steps.py`) |

---

## üìå Notes

* Supports dynamic inflow perturbations via `PERTURBATION` macro.
* Can be extended with additional post-processed variables by editing `__macr_names__` in `get_sim_info.py`.

---

## üß™ Example

```bash
./pipeline.sh D3Q19 000
```

This compiles, runs the simulation, and generates `.vtr` files in `bin/D3Q19/000/` viewable in **ParaView**.

---

## üß† Project Context

This code was developed as part of an undergraduate research fellowship at the Geoenergia Lab (UDESC - Balne√°rio Cambori√∫ Campus), under the project:

**"Numerical Modeling of Oil in the Sea Based on Chemical and Mechanical Subsea Dispersion Experiments (SUBJET)"**, in partnership with **Petrobras**.

## üì¨ Contact

For feature requests or contributions, feel free to open an issue or fork the project. You may also contact the maintainer via email at:

* breno.gemelgo@edu.udesc.br

